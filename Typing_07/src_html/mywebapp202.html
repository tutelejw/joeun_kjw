<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyWebApp</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Inter Font (Google Fonts) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        /* 페이지 전환 효과를 위한 CSS */
        .page-section {
            display: none; /* 기본적으로 숨김 */
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.4s ease-out, transform 0.4s ease-out;
            width: 100%; /* 너비 100% 설정 */
            max-width: 1024px; /* 최대 너비 설정 */
            margin: 0 auto; /* 중앙 정렬 */
        }
        .page-section.active {
            display: block;
            opacity: 1;
            transform: translateY(0);
        }
        /* 드롭다운 메뉴 스타일 */
        .dropdown-content {
            display: none;
            position: absolute;
            background-color: #ffffff;
            min-width: 160px;
            box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.1);
            z-index: 10;
            border-radius: 0.5rem;
            overflow: hidden;
            right: 0; /* 드롭다운을 오른쪽으로 정렬 */
            top: 100%; /* 드롭다운을 버튼 아래에 위치 */
            margin-top: 0.5rem; /* 버튼과의 간격 */
        }
        .dropdown-content a {
            color: #374151; /* gray-700 */
            padding: 12px 16px;
            text-decoration: none;
            display: block;
            font-weight: 500; /* medium */
        }
        .dropdown-content a:hover {
            background-color: #f3f4f6; /* gray-100 */
        }
        /* 드롭다운 호버 시 내용 표시 */
        .dropdown:hover .dropdown-content {
            display: block;
        }
        /* 상품 카드 이미지 비율 유지 */
        .product-image-container {
            width: 100%;
            padding-bottom: 75%; /* 4:3 비율 (300/400 = 0.75) */
            position: relative;
            overflow: hidden;
        }
        .product-image-container img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover; /* 이미지가 컨테이너를 채우도록 */
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">
    <!-- 메인 헤더 (네비게이션 바) -->
    <header id="main-header" class="bg-white shadow-md p-4 flex justify-between items-center sticky top-0 z-50">
        <div class="flex items-center">
            <a href="#" id="home-link" class="text-2xl font-bold text-indigo-600 rounded-md p-2 hover:bg-indigo-50 transition duration-200">MyWebApp</a>
        </div>
        <nav id="main-nav" class="flex items-center space-x-4">
            <!-- 네비게이션 항목은 JavaScript에 의해 동적으로 로드됩니다. -->
        </nav>
    </header>

    <!-- 메인 콘텐츠 영역 -->
    <main class="flex-grow container mx-auto p-4 flex flex-col items-center justify-center">
        <!-- 홈 페이지 (상품 목록) -->
        <section id="home-page" class="page-section active w-full max-w-6xl bg-white p-6 rounded-lg shadow-lg">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">상품 목록</h2>
            <div class="mb-6 flex justify-center space-x-4">
                <button id="show-classic-products" class="px-6 py-2 bg-indigo-500 text-white font-semibold rounded-md shadow-md hover:bg-indigo-600 transition duration-200">Classic 보기</button>
                <button id="show-thumbnail-products" class="px-6 py-2 bg-indigo-500 text-white font-semibold rounded-md shadow-md hover:bg-indigo-600 transition duration-200">Thumbnail 보기</button>
            </div>
            <div id="product-list-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- 상품이 여기에 렌더링됩니다. -->
            </div>
            <p id="no-products-message" class="text-center text-gray-500 mt-8 hidden">등록된 상품이 없습니다.</p>
        </section>

        <!-- 로그인 페이지 -->
        <section id="login-page" class="page-section w-full max-w-md bg-white p-8 rounded-lg shadow-lg">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">로그인</h2>
            <form id="login-form" class="space-y-6">
                <div>
                    <label for="login-username" class="block text-sm font-medium text-gray-700">사용자 이름</label>
                    <input type="text" id="login-username" name="username" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>
                <div>
                    <label for="login-password" class="block text-sm font-medium text-gray-700">비밀번호</label>
                    <input type="password" id="login-password" name="password" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>
                <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-200">로그인</button>
                <p id="login-error-message" class="text-red-500 text-sm text-center mt-2 hidden"></p>
            </form>
        </section>

        <!-- 회원가입 페이지 -->
        <section id="signup-page" class="page-section w-full max-w-md bg-white p-8 rounded-lg shadow-lg">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">회원가입</h2>
            <form id="signup-form" class="space-y-6">
                <div>
                    <label for="signup-username" class="block text-sm font-medium text-gray-700">사용자 이름</label>
                    <input type="text" id="signup-username" name="username" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>
                <div>
                    <label for="signup-password" class="block text-sm font-medium text-gray-700">비밀번호</label>
                    <input type="password" id="signup-password" name="password" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>
                <div>
                    <label for="signup-role" class="block text-sm font-medium text-gray-700">역할</label>
                    <select id="signup-role" name="role" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                        <option value="user">일반 사용자</option>
                        <option value="admin">관리자</option>
                    </select>
                </div>
                <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-200">회원가입</button>
                <p id="signup-error-message" class="text-red-500 text-sm text-center mt-2 hidden"></p>
            </form>
        </section>

        <!-- 상품 관리 페이지 (관리자 전용) -->
        <section id="product-manage-page" class="page-section w-full max-w-2xl bg-white p-8 rounded-lg shadow-lg">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">상품 관리</h2>
            <form id="product-form" class="space-y-6 mb-8 p-6 border border-gray-200 rounded-lg">
                <h3 class="text-2xl font-bold text-gray-700 mb-4">상품 등록/수정</h3>
                <input type="hidden" id="product-id">
                <div>
                    <label for="product-name" class="block text-sm font-medium text-gray-700">상품명</label>
                    <input type="text" id="product-name" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>
                <div>
                    <label for="product-price" class="block text-sm font-medium text-gray-700">가격</label>
                    <input type="number" id="product-price" required class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>
                <div>
                    <label for="product-description" class="block text-sm font-medium text-gray-700">설명</label>
                    <textarea id="product-description" rows="4" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm"></textarea>
                </div>
                <div>
                    <label for="product-image" class="block text-sm font-medium text-gray-700">이미지 URL</label>
                    <input type="text" id="product-image" value="https://placehold.co/400x300/E0E7FF/4F46E5?text=Product" class="mt-1 block w-full px-4 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                </div>
                <button type="submit" class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition duration-200">상품 저장</button>
            </form>

            <h3 class="text-2xl font-bold text-gray-800 mt-10 mb-4 text-center">등록된 상품 목록</h3>
            <div id="admin-product-list" class="space-y-4">
                <!-- 관리자용 상품 목록 (수정/삭제 버튼 포함) -->
            </div>
            <p id="no-admin-products-message" class="text-center text-gray-500 mt-8 hidden">등록된 상품이 없습니다.</p>
        </section>

        <!-- 회원 관리 페이지 (관리자 전용) -->
        <section id="user-manage-page" class="page-section w-full max-w-2xl bg-white p-8 rounded-lg shadow-lg">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">회원 관리</h2>
            <div id="user-list-container" class="space-y-4">
                <!-- 회원 목록이 여기에 렌더링됩니다. -->
            </div>
            <p id="no-users-message" class="text-center text-gray-500 mt-8 hidden">등록된 회원이 없습니다.</p>
        </section>

        <!-- 내 정보 페이지 (일반 사용자) -->
        <section id="my-info-page" class="page-section w-full max-w-md bg-white p-8 rounded-lg shadow-lg">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">내 정보</h2>
            <div id="user-info-display" class="space-y-4 text-lg text-gray-700">
                <p><span class="font-semibold">사용자 이름:</span> <span id="display-username"></span></p>
                <p><span class="font-semibold">역할:</span> <span id="display-role"></span></p>
            </div>
            <button id="delete-account-button" class="mt-6 w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-red-600 hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-red-500 transition duration-200">회원 탈퇴</button>
        </section>

        <!-- 상품 상세 페이지 -->
        <section id="product-detail-page" class="page-section w-full max-w-3xl bg-white p-8 rounded-lg shadow-lg">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center" id="detail-product-name"></h2>
            <div class="flex flex-col md:flex-row gap-6">
                <div class="md:w-1/2">
                    <div class="product-image-container rounded-lg shadow-md">
                        <img id="detail-product-image" src="" alt="상품 이미지" class="w-full h-full object-cover rounded-lg">
                    </div>
                </div>
                <div class="md:w-1/2 space-y-4">
                    <p class="text-2xl font-bold text-indigo-600" id="detail-product-price"></p>
                    <p class="text-gray-700 text-base" id="detail-product-description"></p>
                </div>
            </div>
            <button id="back-to-products-button" class="mt-8 px-6 py-2 bg-gray-200 text-gray-800 font-semibold rounded-md shadow-md hover:bg-gray-300 transition duration-200">목록으로 돌아가기</button>
        </section>

        <!-- 게시판 페이지 -->
        <section id="bulletin-board-page" class="page-section w-full max-w-4xl bg-white p-8 rounded-lg shadow-lg">
            <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">게시판</h2>
            <div class="space-y-6 text-gray-700">
                <div class="border-b pb-4">
                    <h3 class="text-xl font-semibold text-indigo-700">공지사항: MyWebApp 오픈!</h3>
                    <p class="text-sm text-gray-500 mt-1">2025년 7월 26일</p>
                    <p class="mt-2 text-base">MyWebApp이 드디어 오픈했습니다! 다양한 상품을 만나보세요. 사용자 여러분의 많은 이용 부탁드립니다.</p>
                </div>
                <div class="border-b pb-4">
                    <h3 class="text-xl font-semibold text-indigo-700">FAQ: 비밀번호를 잊어버렸어요.</h3>
                    <p class="text-sm text-gray-500 mt-1">2025년 7월 26일</p>
                    <p class="mt-2 text-base">현재 비밀번호 찾기 기능은 제공되지 않습니다. 새로운 계정을 생성해주세요. 불편을 드려 죄송합니다.</p>
                </div>
                <div class="border-b pb-4">
                    <h3 class="text-xl font-semibold text-indigo-700">FAQ: 상품 등록은 어떻게 하나요?</h3>
                    <p class="text-sm text-gray-500 mt-1">2025년 7월 26일</p>
                    <p class="mt-2 text-base">관리자 계정으로 로그인 후 '상품 관리' 메뉴에서 상품을 등록, 수정, 삭제할 수 있습니다.</p>
                </div>
                <div>
                    <h3 class="text-xl font-semibold text-indigo-700">문의사항</h3>
                    <p class="text-sm text-gray-500 mt-1">궁금한 점이 있으시면 언제든지 문의해주세요.</p>
                    <p class="mt-2 text-base">이메일: support@mywebapp.com</p>
                </div>
            </div>
        </section>
    </main>

    <!-- 메시지/확인 모달 -->
    <div id="message-modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white p-6 rounded-lg shadow-xl max-w-sm w-full text-center">
            <p id="modal-message" class="text-lg font-semibold text-gray-800 mb-4"></p>
            <div id="modal-buttons" class="flex justify-center space-x-4">
                <button id="modal-confirm-button" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition duration-200 hidden">확인</button>
                <button id="modal-cancel-button" class="px-4 py-2 bg-gray-300 text-gray-800 rounded-md hover:bg-gray-400 transition duration-200 hidden">취소</button>
                <button id="modal-ok-button" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 transition duration-200">확인</button>
            </div>
        </div>
    </div>

    <script>
        // DOM 요소 가져오기
        const mainHeader = document.getElementById('main-header');
        const mainNav = document.getElementById('main-nav');
        const homeLink = document.getElementById('home-link');
        const pages = document.querySelectorAll('.page-section');

        // 페이지 섹션
        const homePage = document.getElementById('home-page');
        const loginPage = document.getElementById('login-page');
        const signupPage = document.getElementById('signup-page');
        const productManagePage = document.getElementById('product-manage-page');
        const userManagePage = document.getElementById('user-manage-page');
        const myInfoPage = document.getElementById('my-info-page');
        const productDetailPage = document.getElementById('product-detail-page');
        const bulletinBoardPage = document.getElementById('bulletin-board-page');

        // 폼 요소
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const productForm = document.getElementById('product-form');

        // 메시지 모달 요소
        const messageModal = document.getElementById('message-modal');
        const modalMessage = document.getElementById('modal-message');
        const modalConfirmButton = document.getElementById('modal-confirm-button');
        const modalCancelButton = document.getElementById('modal-cancel-button');
        const modalOkButton = document.getElementById('modal-ok-button');

        // 로컬 스토리지에서 데이터 로드
        let users = JSON.parse(localStorage.getItem('users')) || [];
        let products = JSON.parse(localStorage.getItem('products')) || [];
        let currentUser = JSON.parse(localStorage.getItem('currentUser')) || null;

        // 현재 상품 목록 레이아웃 (기본값: classic)
        let currentProductLayout = 'classic';

        /**
         * 모달 메시지를 표시합니다.
         * @param {string} message - 표시할 메시지
         * @param {boolean} isConfirm - 확인/취소 버튼을 표시할지 여부 (true: 확인/취소, false: 확인)
         * @returns {Promise<boolean>} - 확인 버튼 클릭 시 true, 취소 버튼 클릭 시 false를 반환하는 Promise
         */
        function showModal(message, isConfirm = false) {
            modalMessage.textContent = message;
            messageModal.classList.remove('hidden');

            if (isConfirm) {
                modalConfirmButton.classList.remove('hidden');
                modalCancelButton.classList.remove('hidden');
                modalOkButton.classList.add('hidden');
            } else {
                modalConfirmButton.classList.add('hidden');
                modalCancelButton.classList.add('hidden');
                modalOkButton.classList.remove('hidden');
            }

            return new Promise((resolve) => {
                modalOkButton.onclick = () => {
                    messageModal.classList.add('hidden');
                    resolve(true);
                };
                modalConfirmButton.onclick = () => {
                    messageModal.classList.add('hidden');
                    resolve(true);
                };
                modalCancelButton.onclick = () => {
                    messageModal.classList.add('hidden');
                    resolve(false);
                };
            });
        }

        /**
         * 모든 페이지 섹션을 숨깁니다.
         */
        function hideAllPages() {
            pages.forEach(page => {
                page.classList.remove('active');
            });
        }

        /**
         * 특정 페이지 섹션을 표시합니다.
         * @param {HTMLElement} pageElement - 표시할 페이지의 DOM 요소
         */
        function showPage(pageElement) {
            hideAllPages();
            pageElement.classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' }); // 페이지 상단으로 스크롤
        }

        /**
         * 헤더의 네비게이션 바를 업데이트합니다.
         * 사용자 로그인 상태 및 역할에 따라 다른 링크를 표시합니다.
         */
        function renderHeader() {
            mainNav.innerHTML = ''; // 기존 네비게이션 항목 초기화

            // 상품 목록 링크 (로그인 상태와 무관하게 항상 표시)
            const productListNav = document.createElement('div');
            productListNav.className = 'relative dropdown';
            productListNav.innerHTML = `
                <button class="px-4 py-2 text-gray-700 font-semibold rounded-md hover:bg-gray-100 transition duration-200 flex items-center">
                    상품목록 <span class="ml-1">▾</span>
                </button>
                <div class="dropdown-content">
                    <a href="#" id="nav-classic-products">Classic</a>
                    <a href="#" id="nav-thumbnail-products">Thumbnail</a>
                </div>
            `;
            mainNav.appendChild(productListNav);

            // 게시판 링크 (로그인 상태와 무관하게 항상 표시)
            const bulletinBoardLink = document.createElement('a');
            bulletinBoardLink.href = "#";
            bulletinBoardLink.id = "nav-bulletin-board";
            bulletinBoardLink.className = "px-4 py-2 text-gray-700 font-semibold rounded-md hover:bg-gray-100 transition duration-200";
            bulletinBoardLink.textContent = "게시판";
            mainNav.appendChild(bulletinBoardLink);

            if (currentUser) {
                // 로그인 상태
                if (currentUser.role === 'admin') {
                    // 관리자 메뉴
                    const userManageNav = document.createElement('div');
                    userManageNav.className = 'relative dropdown';
                    userManageNav.innerHTML = `
                        <button class="px-4 py-2 text-gray-700 font-semibold rounded-md hover:bg-gray-100 transition duration-200 flex items-center">
                            회원관리 <span class="ml-1">▾</span>
                        </button>
                        <div class="dropdown-content">
                            <a href="#" id="nav-user-manage">회원 목록 보기</a>
                        </div>
                    `;
                    mainNav.appendChild(userManageNav);

                    const productManageNav = document.createElement('div');
                    productManageNav.className = 'relative dropdown';
                    productManageNav.innerHTML = `
                        <button class="px-4 py-2 text-gray-700 font-semibold rounded-md hover:bg-gray-100 transition duration-200 flex items-center">
                            상품관리 <span class="ml-1">▾</span>
                        </button>
                        <div class="dropdown-content">
                            <a href="#" id="nav-product-add">상품 등록</a>
                            <a href="#" id="nav-product-manage">상품 목록 보기</a>
                        </div>
                    `;
                    mainNav.appendChild(productManageNav);

                    const adminDropdown = document.createElement('div');
                    adminDropdown.className = 'relative dropdown';
                    adminDropdown.innerHTML = `
                        <button class="px-4 py-2 bg-indigo-100 text-indigo-700 font-semibold rounded-md hover:bg-indigo-200 transition duration-200 flex items-center">
                            관리자님 <span class="ml-1">▾</span>
                        </button>
                        <div class="dropdown-content">
                            <a href="#" id="nav-logout">로그아웃</a>
                        </div>
                    `;
                    mainNav.appendChild(adminDropdown);

                } else {
                    // 일반 사용자 메뉴
                    const userDropdown = document.createElement('div');
                    userDropdown.className = 'relative dropdown';
                    userDropdown.innerHTML = `
                        <button class="px-4 py-2 bg-indigo-100 text-indigo-700 font-semibold rounded-md hover:bg-indigo-200 transition duration-200 flex items-center">
                            ${currentUser.username}님 <span class="ml-1">▾</span>
                        </button>
                        <div class="dropdown-content">
                            <a href="#" id="nav-my-info">내 정보 보기</a>
                            <a href="#" id="nav-logout">로그아웃</a>
                        </div>
                    `;
                    mainNav.appendChild(userDropdown);
                }
            } else {
                // 로그아웃 상태
                const loginLink = document.createElement('a');
                loginLink.href = "#";
                loginLink.id = "nav-login";
                loginLink.className = "px-4 py-2 text-gray-700 font-semibold rounded-md hover:bg-gray-100 transition duration-200";
                loginLink.textContent = "로그인";
                mainNav.appendChild(loginLink);

                const signupLink = document.createElement('a');
                signupLink.href = "#";
                signupLink.id = "nav-signup";
                signupLink.className = "px-4 py-2 bg-indigo-600 text-white font-semibold rounded-md shadow-md hover:bg-indigo-700 transition duration-200";
                signupLink.textContent = "회원가입";
                mainNav.appendChild(signupLink);
            }

            // 네비게이션 링크에 이벤트 리스너 추가
            addNavEventListeners();
        }

        /**
         * 네비게이션 링크에 클릭 이벤트 리스너를 추가합니다.
         */
        function addNavEventListeners() {
            document.getElementById('nav-classic-products')?.addEventListener('click', (e) => {
                e.preventDefault();
                currentProductLayout = 'classic';
                renderProducts();
                showPage(homePage);
            });
            document.getElementById('nav-thumbnail-products')?.addEventListener('click', (e) => {
                e.preventDefault();
                currentProductLayout = 'thumbnail';
                renderProducts();
                showPage(homePage);
            });
            document.getElementById('nav-bulletin-board')?.addEventListener('click', (e) => {
                e.preventDefault();
                showPage(bulletinBoardPage);
            });
            document.getElementById('nav-login')?.addEventListener('click', (e) => {
                e.preventDefault();
                showPage(loginPage);
            });
            document.getElementById('nav-signup')?.addEventListener('click', (e) => {
                e.preventDefault();
                showPage(signupPage);
            });
            document.getElementById('nav-logout')?.addEventListener('click', (e) => {
                e.preventDefault();
                logoutUser();
            });
            document.getElementById('nav-my-info')?.addEventListener('click', (e) => {
                e.preventDefault();
                renderMyInfo();
                showPage(myInfoPage);
            });
            document.getElementById('nav-user-manage')?.addEventListener('click', (e) => {
                e.preventDefault();
                renderUserList();
                showPage(userManagePage);
            });
            document.getElementById('nav-product-add')?.addEventListener('click', (e) => {
                e.preventDefault();
                resetProductForm();
                renderAdminProductList(); // 상품 등록 페이지에서도 관리자 상품 목록을 보여줌
                showPage(productManagePage);
            });
            document.getElementById('nav-product-manage')?.addEventListener('click', (e) => {
                e.preventDefault();
                renderAdminProductList();
                showPage(productManagePage);
            });
        }


        /**
         * 로컬 스토리지에 사용자 데이터를 저장합니다.
         */
        function saveUsers() {
            localStorage.setItem('users', JSON.stringify(users));
        }

        /**
         * 로컬 스토리지에 상품 데이터를 저장합니다.
         */
        function saveProducts() {
            localStorage.setItem('products', JSON.stringify(products));
        }

        /**
         * 로컬 스토리지에 현재 로그인된 사용자 정보를 저장합니다.
         */
        function saveCurrentUser() {
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
        }

        /**
         * 사용자 회원가입 처리
         */
        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('signup-username').value.trim();
            const password = document.getElementById('signup-password').value.trim();
            const role = document.getElementById('signup-role').value;
            const errorMessage = document.getElementById('signup-error-message');

            if (!username || !password) {
                errorMessage.textContent = '사용자 이름과 비밀번호를 입력해주세요.';
                errorMessage.classList.remove('hidden');
                return;
            }

            if (users.some(user => user.username === username)) {
                errorMessage.textContent = '이미 존재하는 사용자 이름입니다.';
                errorMessage.classList.remove('hidden');
                return;
            }

            users.push({ id: Date.now(), username, password, role });
            saveUsers();
            errorMessage.classList.add('hidden');
            await showModal('회원가입이 완료되었습니다. 로그인해주세요.');
            signupForm.reset();
            showPage(loginPage);
        });

        /**
         * 사용자 로그인 처리
         */
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const username = document.getElementById('login-username').value.trim();
            const password = document.getElementById('login-password').value.trim();
            const errorMessage = document.getElementById('login-error-message');

            const user = users.find(u => u.username === username && u.password === password);

            if (user) {
                currentUser = user;
                saveCurrentUser();
                errorMessage.classList.add('hidden');
                await showModal(`${user.username}님, 환영합니다!`);
                loginForm.reset();
                renderHeader();
                renderProducts(); // 로그인 후 상품 목록 새로고침
                showPage(homePage);
            } else {
                errorMessage.textContent = '잘못된 사용자 이름 또는 비밀번호입니다.';
                errorMessage.classList.remove('hidden');
            }
        });

        /**
         * 사용자 로그아웃 처리
         */
        function logoutUser() {
            currentUser = null;
            saveCurrentUser();
            showModal('로그아웃되었습니다.');
            renderHeader();
            renderProducts(); // 로그아웃 후 상품 목록 새로고침
            showPage(homePage);
        }

        /**
         * 사용자 탈퇴 처리 (일반 사용자)
         */
        document.getElementById('delete-account-button').addEventListener('click', async () => {
            const confirmDelete = await showModal('정말로 계정을 탈퇴하시겠습니까? 이 작업은 되돌릴 수 없습니다.', true);
            if (confirmDelete) {
                users = users.filter(user => user.id !== currentUser.id);
                saveUsers();
                logoutUser();
                await showModal('계정이 성공적으로 탈퇴되었습니다.');
            }
        });

        /**
         * 상품 목록을 렌더링합니다. (Classic 또는 Thumbnail 레이아웃)
         */
        function renderProducts() {
            const container = document.getElementById('product-list-container');
            container.innerHTML = ''; // 기존 목록 초기화
            const noProductsMessage = document.getElementById('no-products-message');

            if (products.length === 0) {
                noProductsMessage.classList.remove('hidden');
                return;
            } else {
                noProductsMessage.classList.add('hidden');
            }

            products.forEach(product => {
                const productCard = document.createElement('div');
                productCard.className = 'bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition duration-300 cursor-pointer';
                productCard.onclick = () => showProductDetail(product.id);

                if (currentProductLayout === 'classic') {
                    productCard.innerHTML = `
                        <div class="product-image-container">
                            <img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover">
                        </div>
                        <div class="p-4">
                            <h3 class="text-xl font-semibold text-gray-800 mb-2">${product.name}</h3>
                            <p class="text-indigo-600 font-bold text-lg mb-2">${product.price.toLocaleString()}원</p>
                            <p class="text-gray-600 text-sm">${product.description.substring(0, 70)}...</p>
                        </div>
                    `;
                } else { // thumbnail
                    productCard.className = 'flex items-center bg-white rounded-lg shadow-md p-4 hover:shadow-xl transition duration-300 cursor-pointer';
                    productCard.innerHTML = `
                        <div class="w-24 h-24 flex-shrink-0 product-image-container mr-4">
                            <img src="${product.image}" alt="${product.name}" class="w-full h-full object-cover rounded-md">
                        </div>
                        <div class="flex-grow">
                            <h3 class="text-lg font-semibold text-gray-800">${product.name}</h3>
                            <p class="text-indigo-600 font-bold text-md">${product.price.toLocaleString()}원</p>
                            <p class="text-gray-600 text-sm hidden sm:block">${product.description.substring(0, 50)}...</p>
                        </div>
                    `;
                }
                container.appendChild(productCard);
            });
        }

        // 상품 목록 레이아웃 변경 버튼 이벤트 리스너
        document.getElementById('show-classic-products').addEventListener('click', () => {
            currentProductLayout = 'classic';
            renderProducts();
        });
        document.getElementById('show-thumbnail-products').addEventListener('click', () => {
            currentProductLayout = 'thumbnail';
            renderProducts();
        });

        /**
         * 상품 상세 정보를 표시합니다.
         * @param {number} productId - 상세 정보를 볼 상품의 ID
         */
        function showProductDetail(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                document.getElementById('detail-product-name').textContent = product.name;
                document.getElementById('detail-product-image').src = product.image;
                document.getElementById('detail-product-price').textContent = `${product.price.toLocaleString()}원`;
                document.getElementById('detail-product-description').textContent = product.description;
                showPage(productDetailPage);
            } else {
                showModal('상품을 찾을 수 없습니다.');
            }
        }

        // 상품 상세 페이지에서 목록으로 돌아가기 버튼
        document.getElementById('back-to-products-button').addEventListener('click', () => {
            showPage(homePage);
            renderProducts(); // 상품 목록 다시 렌더링
        });

        /**
         * 상품 등록/수정 폼 초기화
         */
        function resetProductForm() {
            document.getElementById('product-id').value = '';
            document.getElementById('product-name').value = '';
            document.getElementById('product-price').value = '';
            document.getElementById('product-description').value = '';
            document.getElementById('product-image').value = 'https://placehold.co/400x300/E0E7FF/4F46E5?text=Product';
            productForm.querySelector('button[type="submit"]').textContent = '상품 저장';
        }

        /**
         * 상품 등록/수정 처리
         */
        productForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (currentUser?.role !== 'admin') {
                await showModal('상품을 등록/수정할 권한이 없습니다.');
                return;
            }

            const productId = document.getElementById('product-id').value;
            const name = document.getElementById('product-name').value.trim();
            const price = parseInt(document.getElementById('product-price').value);
            const description = document.getElementById('product-description').value.trim();
            const image = document.getElementById('product-image').value.trim();

            if (!name || isNaN(price) || price <= 0) {
                await showModal('상품명과 유효한 가격을 입력해주세요.');
                return;
            }

            if (productId) {
                // 상품 수정
                const index = products.findIndex(p => p.id === parseInt(productId));
                if (index !== -1) {
                    products[index] = { id: parseInt(productId), name, price, description, image };
                    await showModal('상품이 성공적으로 수정되었습니다.');
                }
            } else {
                // 상품 등록
                const newProduct = {
                    id: Date.now(),
                    name,
                    price,
                    description,
                    image: image || 'https://placehold.co/400x300/E0E7FF/4F46E5?text=Product'
                };
                products.push(newProduct);
                await showModal('상품이 성공적으로 등록되었습니다.');
            }
            saveProducts();
            resetProductForm();
            renderAdminProductList(); // 관리자 상품 목록 새로고침
            renderProducts(); // 일반 상품 목록 새로고침
        });

        /**
         * 관리자용 상품 목록을 렌더링합니다. (수정/삭제 버튼 포함)
         */
        function renderAdminProductList() {
            const container = document.getElementById('admin-product-list');
            container.innerHTML = '';
            const noAdminProductsMessage = document.getElementById('no-admin-products-message');

            if (products.length === 0) {
                noAdminProductsMessage.classList.remove('hidden');
                return;
            } else {
                noAdminProductsMessage.classList.add('hidden');
            }

            products.forEach(product => {
                const productItem = document.createElement('div');
                productItem.className = 'flex items-center justify-between bg-gray-50 p-4 rounded-md shadow-sm border border-gray-200';
                productItem.innerHTML = `
                    <div class="flex-grow">
                        <h4 class="text-lg font-semibold text-gray-800">${product.name}</h4>
                        <p class="text-indigo-600 font-bold">${product.price.toLocaleString()}원</p>
                    </div>
                    <div class="flex space-x-2">
                        <button data-id="${product.id}" class="edit-product-btn px-4 py-2 bg-blue-500 text-white text-sm rounded-md hover:bg-blue-600 transition duration-200">수정</button>
                        <button data-id="${product.id}" class="delete-product-btn px-4 py-2 bg-red-500 text-white text-sm rounded-md hover:bg-red-600 transition duration-200">삭제</button>
                    </div>
                `;
                container.appendChild(productItem);
            });

            // 수정 버튼 이벤트 리스너
            container.querySelectorAll('.edit-product-btn').forEach(button => {
                button.addEventListener('click', (e) => {
                    const productId = parseInt(e.target.dataset.id);
                    const productToEdit = products.find(p => p.id === productId);
                    if (productToEdit) {
                        document.getElementById('product-id').value = productToEdit.id;
                        document.getElementById('product-name').value = productToEdit.name;
                        document.getElementById('product-price').value = productToEdit.price;
                        document.getElementById('product-description').value = productToEdit.description;
                        document.getElementById('product-image').value = productToEdit.image;
                        productForm.querySelector('button[type="submit"]').textContent = '상품 수정';
                        window.scrollTo({ top: 0, behavior: 'smooth' }); // 폼으로 스크롤
                    }
                });
            });

            // 삭제 버튼 이벤트 리스너
            container.querySelectorAll('.delete-product-btn').forEach(button => {
                button.addEventListener('click', async (e) => {
                    const productId = parseInt(e.target.dataset.id);
                    const confirmDelete = await showModal('정말로 이 상품을 삭제하시겠습니까?', true);
                    if (confirmDelete) {
                        products = products.filter(p => p.id !== productId);
                        saveProducts();
                        await showModal('상품이 성공적으로 삭제되었습니다.');
                        renderAdminProductList(); // 관리자 상품 목록 새로고침
                        renderProducts(); // 일반 상품 목록 새로고침
                    }
                });
            });
        }

        /**
         * 회원 목록을 렌더링합니다. (관리자 전용)
         */
        function renderUserList() {
            const container = document.getElementById('user-list-container');
            container.innerHTML = '';
            const noUsersMessage = document.getElementById('no-users-message');

            if (users.length === 0) {
                noUsersMessage.classList.remove('hidden');
                return;
            } else {
                noUsersMessage.classList.add('hidden');
            }

            users.forEach(user => {
                const userItem = document.createElement('div');
                userItem.className = 'flex items-center justify-between bg-gray-50 p-4 rounded-md shadow-sm border border-gray-200';
                userItem.innerHTML = `
                    <div class="flex-grow">
                        <h4 class="text-lg font-semibold text-gray-800">${user.username}</h4>
                        <p class="text-gray-600 text-sm">역할: ${user.role === 'admin' ? '관리자' : '일반 사용자'}</p>
                    </div>
                    ${user.id !== currentUser?.id ? `<button data-id="${user.id}" class="delete-user-btn px-4 py-2 bg-red-500 text-white text-sm rounded-md hover:bg-red-600 transition duration-200">삭제</button>` : ''}
                `;
                container.appendChild(userItem);
            });

            // 사용자 삭제 버튼 이벤트 리스너
            container.querySelectorAll('.delete-user-btn').forEach(button => {
                button.addEventListener('click', async (e) => {
                    const userId = parseInt(e.target.dataset.id);
                    const userToDelete = users.find(u => u.id === userId);

                    if (userToDelete.role === 'admin') {
                        await showModal('관리자 계정은 삭제할 수 없습니다.');
                        return;
                    }

                    const confirmDelete = await showModal(`정말로 사용자 '${userToDelete.username}'을(를) 삭제하시겠습니까?`, true);
                    if (confirmDelete) {
                        users = users.filter(u => u.id !== userId);
                        saveUsers();
                        await showModal('사용자가 성공적으로 삭제되었습니다.');
                        renderUserList(); // 회원 목록 새로고침
                    }
                });
            });
        }

        /**
         * 내 정보 페이지를 렌더링합니다.
         */
        function renderMyInfo() {
            if (currentUser) {
                document.getElementById('display-username').textContent = currentUser.username;
                document.getElementById('display-role').textContent = currentUser.role === 'admin' ? '관리자' : '일반 사용자';
            }
        }

        // 초기 로드 시 실행
        document.addEventListener('DOMContentLoaded', () => {
            renderHeader();
            renderProducts();
            showPage(homePage); // 초기에는 홈 페이지 표시
        });

        // 홈 링크 클릭 시 홈 페이지로 이동
        homeLink.addEventListener('click', (e) => {
            e.preventDefault();
            showPage(homePage);
            renderProducts();
        });

        // 초기 샘플 데이터 (로컬 스토리지에 데이터가 없을 때만 추가)
        if (users.length === 0) {
            users.push({ id: 1, username: 'admin', password: 'admin', role: 'admin' });
            users.push({ id: 2, username: 'user1', password: 'user1', role: 'user' });
            saveUsers();
        }
        if (products.length === 0) {
            products.push({ id: 101, name: '프리미엄 커피 원두', price: 25000, description: '고품질 아라비카 원두로 깊고 풍부한 맛을 선사합니다. 집에서 바리스타가 된 듯한 경험을 해보세요.', image: 'https://images.unsplash.com/photo-1511920170033-f8396924c348?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' });
            products.push({ id: 102, name: '스마트 워치', price: 150000, description: '심박수 측정, 활동량 추적, 알림 기능 등 다양한 스마트 기능을 제공하는 세련된 디자인의 워치입니다.', image: 'https://images.unsplash.com/photo-1546868871-7041f2a55e12?q=80&w=1964&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' });
            products.push({ id: 103, name: '무선 이어폰', price: 89000, description: '선명한 사운드와 편안한 착용감을 제공하는 무선 이어폰. 이동 중에도 끊김 없는 음악을 즐기세요.', image: 'https://images.unsplash.com/photo-1606220588913-b3f7d7b6b177?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' });
            products.push({ id: 104, name: '고급 가죽 지갑', price: 55000, description: '최고급 가죽으로 제작된 세련된 디자인의 지갑. 뛰어난 내구성과 수납 공간을 자랑합니다.', image: 'https://images.unsplash.com/photo-1590494392901-098522338b29?q=80&w=2070&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' });
            products.push({ id: 105, name: '휴대용 미니 선풍기', price: 18000, description: '강력한 바람과 휴대성을 겸비한 미니 선풍기. 여름철 필수 아이템입니다.', image: 'https://images.unsplash.com/photo-1628126131464-969c3a34a949?q=80&w=1974&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' });
            products.push({ id: 106, name: '친환경 세탁 세제', price: 12000, description: '자연 유래 성분으로 만들어져 피부에 순하고 환경에도 좋습니다. 강력한 세척력은 기본!', image: 'https://images.unsplash.com/photo-1621939983946-b25712f5a65c?q=80&w=1932&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D' });
            saveProducts();
        }
    </script>
</body>
</html>
